<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>FunASR 语音识别</title>
		<style>
			* {
				box-sizing: border-box;
				margin: 0;
				padding: 0;
			}

			body {
				font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				min-height: 100vh;
				padding: 20px;
				color: #333;
			}

			.container {
				max-width: 1200px;
				margin: 0 auto;
				background: white;
				border-radius: 20px;
				box-shadow: 0 20px 40px rgba(0,0,0,0.1);
				overflow: hidden;
			}

			.header {
				background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
				color: white;
				padding: 30px;
				text-align: center;
			}

			.header h1 {
				font-size: 2.5em;
				margin-bottom: 10px;
				font-weight: 300;
			}

			.header p {
				font-size: 1.1em;
				opacity: 0.9;
				line-height: 1.6;
			}

			.content {
				padding: 30px;
			}

			.card {
				background: #f8f9fa;
				border-radius: 15px;
				padding: 25px;
				margin-bottom: 20px;
				border: 1px solid #e9ecef;
				transition: all 0.3s ease;
			}

			.card:hover {
				transform: translateY(-2px);
				box-shadow: 0 8px 25px rgba(0,0,0,0.1);
			}

			.card-title {
				font-size: 1.2em;
				font-weight: 600;
				margin-bottom: 15px;
				color: #495057;
				display: flex;
				align-items: center;
			}

			.card-title::before {
				content: '';
				width: 4px;
				height: 20px;
				background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
				margin-right: 10px;
				border-radius: 2px;
			}

			.form-group {
				margin-bottom: 20px;
			}

			.form-label {
				display: block;
				margin-bottom: 8px;
				font-weight: 500;
				color: #495057;
			}

			.form-input {
				width: 100%;
				padding: 12px 16px;
				border: 2px solid #e9ecef;
				border-radius: 10px;
				font-size: 14px;
				transition: all 0.3s ease;
			}

			.form-input:focus {
				outline: none;
				border-color: #4facfe;
				box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
			}

			.radio-group {
				display: flex;
				gap: 20px;
				flex-wrap: wrap;
			}

			.radio-item {
				display: flex;
				align-items: center;
				cursor: pointer;
				padding: 10px 15px;
				border-radius: 8px;
				transition: all 0.3s ease;
				border: 2px solid transparent;
			}

			.radio-item:hover {
				background: #e3f2fd;
			}

			.radio-item input[type="radio"] {
				margin-right: 8px;
				accent-color: #4facfe;
			}

			.textarea {
				width: 100%;
				padding: 15px;
				border: 2px solid #e9ecef;
				border-radius: 10px;
				font-size: 14px;
				font-family: inherit;
				resize: vertical;
				transition: all 0.3s ease;
			}

			.textarea:focus {
				outline: none;
				border-color: #4facfe;
				box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
			}

			.button-group {
				display: flex;
				gap: 15px;
				margin: 25px 0;
				flex-wrap: wrap;
			}

			.btn {
				padding: 12px 30px;
				border: none;
				border-radius: 25px;
				font-size: 16px;
				font-weight: 500;
				cursor: pointer;
				transition: all 0.3s ease;
				min-width: 100px;
			}

			.btn-primary {
				background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
				color: white;
			}

			.btn-success {
				background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
				color: white;
			}

			.btn-danger {
				background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
				color: white;
			}

			.btn:hover {
				transform: translateY(-2px);
				box-shadow: 0 8px 25px rgba(0,0,0,0.15);
			}

			.btn:active {
				transform: translateY(0);
			}

			.status-info {
				padding: 15px;
				background: #e3f2fd;
				border-left: 4px solid #2196f3;
				border-radius: 5px;
				margin: 15px 0;
				font-weight: 500;
			}

			.audio-player {
				width: 100%;
				margin-top: 20px;
				border-radius: 10px;
			}

			.link-button {
				display: inline-block;
				padding: 8px 16px;
				background: #f8f9fa;
				border: 1px solid #dee2e6;
				border-radius: 6px;
				text-decoration: none;
				color: #495057;
				font-size: 14px;
				transition: all 0.3s ease;
				margin-top: 10px;
			}

			.link-button:hover {
				background: #e9ecef;
				text-decoration: none;
			}

			.file-input {
				width: 100%;
				padding: 20px;
				border: 2px dashed #dee2e6;
				border-radius: 10px;
				text-align: center;
				transition: all 0.3s ease;
				cursor: pointer;
			}

			.file-input:hover {
				border-color: #4facfe;
				background: #f8f9fa;
			}

			@media (max-width: 768px) {
				.content {
					padding: 20px;
				}
				
				.header {
					padding: 20px;
				}
				
				.header h1 {
					font-size: 2em;
				}
				
				.radio-group {
					flex-direction: column;
					gap: 10px;
				}
				
				.button-group {
					flex-direction: column;
				}
			}
		</style>
	</head>
	<body>
		<script src="recorder-core.js" charset="UTF-8"></script>
		<script src="wav.js" charset="UTF-8"></script>
		<script src="pcm.js" charset="UTF-8"></script>

<div class="container">
			<div class="header">
				<h1>🎤 FunASR Demo 测试</h1>
			</div>
			
			<div class="content">
				<div class="card" style="display:none;">
					<div class="card-title">🌐 服务器配置</div>
					<div class="form-group">
						<label class="form-label">ASR服务器地址 (必填)</label>
						<input id="wssip" type="text" class="form-input" onchange="addresschange()" value="wss://yuyin.jay-zjy.cn:10095" placeholder="请输入WebSocket服务器地址"/>
						<a id="wsslink" href="#" class="link-button" onclick="window.open('https://yuyin.jay-zjy.cn:10095/', '_blank')">
							<span id="info_wslink">🔗 点击授权服务器访问</span>
						</a>
					</div>
				</div>
					<div class="card">
					<div class="card-title">🎙️ 录音模式</div>
					<div class="radio-group">
						<label class="radio-item">
							<input name="recoder_mode" onclick="on_recoder_mode_change()" type="radio" value="mic" checked="true"/>
							麦克风录音
						</label>
						<label class="radio-item">
							<input name="recoder_mode" onclick="on_recoder_mode_change()" type="radio" value="file" />
							文件上传
						</label>
					</div>
				</div>
				
				<div id="mic_mode_div" class="card" style="display:none;">
					<div class="card-title">🤖 ASR模型模式</div>
					<div class="radio-group">
						<label class="radio-item">
							<input name="asr_mode" type="radio" value="2pass" checked="true"/>
							2Pass模式
						</label>
						<label class="radio-item">
							<input name="asr_mode" type="radio" value="online" />
							在线模式
						</label>
						<label class="radio-item">
							<input name="asr_mode" type="radio" value="offline" />
							离线模式
						</label>
					</div>
				</div>
				
				<div id="rec_mode_div" class="card" style="display:none;">
					<div class="card-title">📁 文件上传</div>
					<div class="file-input">
						<input type="file" id="upfile" accept="audio/*">
						<p style="margin-top: 10px; color: #6c757d;">支持常见音频格式：MP3, WAV, M4A等</p>
					</div>
				</div>
				<div id="use_itn_div" class="card" style="display:none;">
					<div class="card-title">🔄 逆文本标准化 (ITN)</div>
					<div class="radio-group">
						<label class="radio-item">
							<input name="use_itn" type="radio" value="false" checked="true"/>
							关闭
						</label>
						<label class="radio-item">
							<input name="use_itn" type="radio" value="true" />
							开启
						</label>
					</div>
				</div>
				<div class="card" style="display:none;">
					<div class="card-title">🔥 热词设置</div>
					<div class="form-group">
						<label class="form-label">一行一个关键字，空格隔开权重 (如：阿里巴巴 20)</label>
						<textarea rows="3" id="varHot" class="textarea" placeholder="请输入热词，每行一个">雅鲁藏布江 20
apple 40</textarea>
					</div>
				</div>
				<div class="card">
					<div class="card-title">📝 识别结果</div>
					<div class="form-group">
						<textarea rows="10" id="varArea" readonly="true" class="textarea" placeholder="语音识别结果将在这里显示..."></textarea>
					</div>
					<div id="info_div" class="status-info">请点击连接按钮开始使用</div>
				</div>
				<div class="card">
					<div class="card-title">🎛️ 控制面板</div>
					<div class="button-group">
						<button id="btnConnect" class="btn btn-primary">🔗 连接服务器</button>
						<button id="btnRecord" class="btn btn-success">▶️ 开始录音</button>
					</div>
					<audio id="audio_record" type="audio/wav" controls class="audio-player"></audio>
				</div>
			</div>
		</div>

		<script src="wsconnecter.js" charset="utf-8"></script>
		<script src="main.js" charset="utf-8"></script>
		
		<!-- Dify Chatbot Configuration -->
		<script>
			window.difyChatbotConfig = {
				token: 'vvwpEKadl1Sy0BG6',
				baseUrl: 'http://yuyin.jay-zjy.cn',
				systemVariables: {
					// user_id: 'YOU CAN DEFINE USER ID HERE',
					// conversation_id: 'YOU CAN DEFINE CONVERSATION ID HERE, IT MUST BE A VALID UUID',
				},
				userVariables: {
					// avatar_url: 'YOU CAN DEFINE USER AVATAR URL HERE',
					// name: 'YOU CAN DEFINE USER NAME HERE',
				},
			}
		</script>
		<script
			src="http://yuyin.jay-zjy.cn/embed.min.js"
			id="vvwpEKadl1Sy0BG6"
			defer>
		</script>
		<style>
			#dify-chatbot-bubble-button {
				background-color: #1C64F2 !important;
			}
			#dify-chatbot-bubble-window {
				width: 40rem !important;
				height: 80rem !important;
			}
		</style>
	</body>
</html>
